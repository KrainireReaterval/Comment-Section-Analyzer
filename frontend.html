import React, { useState } from 'react';
import { BarChart, Bar, LineChart, Line, PieChart, Pie, Cell, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer } from 'recharts';
import { Play, TrendingUp, Brain, Zap, ChevronDown, ChevronUp, Download, ArrowLeft, AlertCircle } from 'lucide-react';

const fontStyle = {
  fontFamily: 'Baskerville, "Baskerville Old Face", "Hoefler Text", Garamond, "Times New Roman", serif',
  fontStyle: 'italic'
};

const mockAnalysisData = {
  basicInfo: {
    videoId: "dQw4w9WgXcQ",
    title: "The Future of Artificial Intelligence in 2025",
    channelName: "Tech Insights",
    thumbnail: "https://images.unsplash.com/photo-1677442136019-21780ecad995?w=800&q=80",
    totalComments: 8547,
    videoDuration: "24:35",
    publishedDate: "2022-03-15",
    publishedAgo: "2 years ago",
    mainTopic: "This video explores the rapid advancement of artificial intelligence, discussing machine learning breakthroughs, ethical considerations, and the impact on various industries including healthcare, finance, and creative work."
  },
  temporalData: [
    { period: "2022 Q2", cumulative: 1250, new: 1250 },
    { period: "2022 Q3", cumulative: 2890, new: 1640 },
    { period: "2022 Q4", cumulative: 4120, new: 1230 },
    { period: "2023 Q1", cumulative: 5340, new: 1220 },
    { period: "2023 Q2", cumulative: 6580, new: 1240 },
    { period: "2023 Q3", cumulative: 7420, new: 840 },
    { period: "2023 Q4", cumulative: 7980, new: 560 },
    { period: "2024 Q1", cumulative: 8547, new: 567 }
  ],
  categories: [
    {
      name: "AI Ethics",
      commentCount: 2564,
      percentage: 30,
      sentiment: {
        positive: { count: 1026, percentage: 40 },
        negative: { count: 1539, percentage: 60 },
        neutral: { count: 0, percentage: 0 }
      },
      controversyRate: 35,
      exampleComments: [
        { text: "AI ethics should be our top priority as we develop these systems", sentiment: "positive", likes: 234, replies: 45 },
        { text: "Companies are rushing AI without considering the consequences", sentiment: "negative", likes: 189, replies: 67 }
      ]
    },
    {
      name: "Job Automation",
      commentCount: 2137,
      percentage: 25,
      sentiment: {
        positive: { count: 641, percentage: 30 },
        negative: { count: 1496, percentage: 70 },
        neutral: { count: 0, percentage: 0 }
      },
      controversyRate: 42,
      exampleComments: [
        { text: "AI will create more jobs than it destroys in the long run", sentiment: "positive", likes: 156, replies: 89 },
        { text: "Millions will lose their jobs and governments aren't prepared", sentiment: "negative", likes: 298, replies: 134 }
      ]
    },
    {
      name: "Healthcare AI",
      commentCount: 1709,
      percentage: 20,
      sentiment: {
        positive: { count: 1367, percentage: 80 },
        negative: { count: 342, percentage: 20 },
        neutral: { count: 0, percentage: 0 }
      },
      controversyRate: 12,
      exampleComments: [
        { text: "AI diagnostics are already saving lives by detecting cancer early", sentiment: "positive", likes: 445, replies: 23 },
        { text: "We still need human doctors, AI can't replace empathy", sentiment: "negative", likes: 87, replies: 34 }
      ]
    },
    {
      name: "Machine Learning",
      commentCount: 1281,
      percentage: 15,
      sentiment: {
        positive: { count: 1025, percentage: 80 },
        negative: { count: 256, percentage: 20 },
        neutral: { count: 0, percentage: 0 }
      },
      controversyRate: 8,
      exampleComments: [
        { text: "The progress in neural networks is absolutely fascinating", sentiment: "positive", likes: 312, replies: 18 }
      ]
    },
    {
      name: "Privacy Concerns",
      commentCount: 856,
      percentage: 10,
      sentiment: {
        positive: { count: 171, percentage: 20 },
        negative: { count: 685, percentage: 80 },
        neutral: { count: 0, percentage: 0 }
      },
      controversyRate: 28,
      exampleComments: [
        { text: "AI systems are collecting way too much personal data", sentiment: "negative", likes: 267, replies: 112 }
      ]
    }
  ],
  keyInsights: [
    "AI Ethics is the most discussed topic, representing 30% of all comments with highly polarized opinions (60% negative)",
    "Job Automation shows the highest controversy rate at 42%, indicating heated debates in comment threads",
    "Healthcare AI receives overwhelmingly positive sentiment (80%), showing audience optimism about medical applications",
    "Comment activity peaked in Q3 2022 with 1,640 new comments, then gradually declined",
    "Privacy Concerns, while only 10% of comments, show strong negative sentiment (80%)"
  ]
};

const COLORS = ['#6b46c1', '#9f7aea', '#b794f4', '#d6bcfa', '#e9d5ff', '#7c3aed'];

const HomePage = ({ onAnalyze }) => {
  const [url, setUrl] = useState('');
  const [error, setError] = useState('');

  const handleSubmit = () => {
    setError('');
    const youtubeRegex = /^(https?:\/\/)?(www\.)?(youtube\.com\/watch\?v=|youtu\.be\/)[\w-]+/;
    if (!youtubeRegex.test(url)) {
      setError('Please enter a valid YouTube URL');
      return;
    }
    onAnalyze(url);
  };

  const handleKeyPress = (e) => {
    if (e.key === 'Enter') {
      handleSubmit();
    }
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-purple-900 via-purple-700 to-purple-500" style={fontStyle}>
      <header className="bg-purple-950 shadow-lg sticky top-0 z-50">
        <div className="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center">
          <div className="flex items-center gap-2">
            <Play className="w-8 h-8 text-purple-300" />
            <span className="text-xl font-bold text-purple-100">YouTube Comment Analyzer</span>
          </div>
          <nav className="flex gap-6">
            <a href="#" className="text-purple-200 hover:text-purple-100 font-medium">Home</a>
            <a href="#" className="text-purple-200 hover:text-purple-100 font-medium">About</a>
            <a href="#" className="text-purple-200 hover:text-purple-100 font-medium">Personalization</a>
          </nav>
        </div>
      </header>

      <main className="max-w-6xl mx-auto px-4 py-16">
        <div className="text-center mb-12">
          <h1 className="text-5xl font-bold text-white mb-4">
            Understand Your YouTube Audience at Scale
          </h1>
          <p className="text-xl text-purple-100 mb-8">
            Analyze up to 10,000 comments instantly with AI-powered insights
          </p>

          <div className="max-w-2xl mx-auto mb-8">
            <div className="flex gap-3">
              <input
                type="text"
                value={url}
                onChange={(e) => setUrl(e.target.value)}
                onKeyPress={handleKeyPress}
                placeholder="Paste YouTube video URL here..."
                className="flex-1 px-6 py-4 text-lg border-2 border-purple-300 rounded-lg focus:border-purple-400 focus:outline-none bg-white"
                style={fontStyle}
              />
              <button
                onClick={handleSubmit}
                className="px-8 py-4 bg-purple-600 text-white font-semibold rounded-lg hover:bg-purple-700 transition"
              >
                Analyze
              </button>
            </div>
            {error && (
              <div className="mt-3 flex items-center gap-2 text-purple-100 justify-center">
                <AlertCircle className="w-4 h-4" />
                <span>{error}</span>
              </div>
            )}
          </div>

          <div className="grid md:grid-cols-3 gap-6 mb-12">
            <div className="bg-yellow-100 p-6 rounded-xl shadow-lg border-2 border-yellow-300">
              <TrendingUp className="w-12 h-12 text-purple-700 mx-auto mb-4" />
              <h3 className="font-bold text-lg mb-2 text-purple-900">10K+ Comments</h3>
              <p className="text-purple-800">Analyze massive comment sections at scale</p>
            </div>
            <div className="bg-yellow-100 p-6 rounded-xl shadow-lg border-2 border-yellow-300">
              <Brain className="w-12 h-12 text-purple-700 mx-auto mb-4" />
              <h3 className="font-bold text-lg mb-2 text-purple-900">AI-Powered Analysis</h3>
              <p className="text-purple-800">Advanced sentiment and topic detection</p>
            </div>
            <div className="bg-yellow-100 p-6 rounded-xl shadow-lg border-2 border-yellow-300">
              <Zap className="w-12 h-12 text-purple-700 mx-auto mb-4" />
              <h3 className="font-bold text-lg mb-2 text-purple-900">Instant Insights</h3>
              <p className="text-purple-800">Get comprehensive reports in minutes</p>
            </div>
          </div>

          <div className="bg-yellow-100 border-2 border-yellow-300 rounded-xl shadow-lg p-6">
            <h2 className="text-2xl font-bold mb-6 text-purple-900">How It Works</h2>
            <div className="flex justify-center items-center gap-6">
              <div className="flex-1 max-w-xs">
                <div className="w-10 h-10 bg-purple-600 text-white rounded-full flex items-center justify-center text-lg font-bold mx-auto mb-2">1</div>
                <h3 className="font-semibold text-base mb-1 text-purple-900">Paste URL</h3>
                <p className="text-sm text-purple-800">Enter any YouTube video link</p>
              </div>
              <div className="text-purple-600 text-2xl">→</div>
              <div className="flex-1 max-w-xs">
                <div className="w-10 h-10 bg-purple-500 text-white rounded-full flex items-center justify-center text-lg font-bold mx-auto mb-2">2</div>
                <h3 className="font-semibold text-base mb-1 text-purple-900">AI Analyzes</h3>
                <p className="text-sm text-purple-800">Our AI processes all comments</p>
              </div>
              <div className="text-purple-600 text-2xl">→</div>
              <div className="flex-1 max-w-xs">
                <div className="w-10 h-10 bg-purple-400 text-white rounded-full flex items-center justify-center text-lg font-bold mx-auto mb-2">3</div>
                <h3 className="font-semibold text-base mb-1 text-purple-900">Get Insights</h3>
                <p className="text-sm text-purple-800">View detailed visualizations</p>
              </div>
            </div>
          </div>
        </div>
      </main>

      <footer className="bg-purple-950 text-purple-200 py-8 mt-16">
        <div className="max-w-6xl mx-auto px-4 text-center">
          <p>&copy; 2025 YouTube Comment Analyzer. All rights reserved.</p>
        </div>
      </footer>
    </div>
  );
};

const LoadingState = () => {
  const [step, setStep] = useState(1);

  React.useEffect(() => {
    const timer = setInterval(() => {
      setStep(s => (s < 3 ? s + 1 : s));
    }, 2000);
    return () => clearInterval(timer);
  }, []);

  return (
    <div className="min-h-screen bg-gradient-to-br from-purple-900 to-purple-600 flex items-center justify-center" style={fontStyle}>
      <div className="bg-purple-800 bg-opacity-50 backdrop-blur rounded-xl shadow-2xl p-12 max-w-md w-full border border-purple-400">
        <div className="text-center">
          <div className="w-16 h-16 border-4 border-purple-300 border-t-transparent rounded-full animate-spin mx-auto mb-6"></div>
          <h2 className="text-2xl font-bold mb-4 text-white">Analyzing Comments</h2>
          <div className="space-y-3">
            <div className={`flex items-center gap-3 ${step >= 1 ? 'text-purple-200' : 'text-purple-400'}`}>
              <div className={`w-6 h-6 rounded-full ${step >= 1 ? 'bg-purple-400' : 'bg-purple-700'} flex items-center justify-center text-white text-sm`}>
                {step > 1 ? '✓' : '1'}
              </div>
              <span className="font-medium">Scraping comments...</span>
            </div>
            <div className={`flex items-center gap-3 ${step >= 2 ? 'text-purple-200' : 'text-purple-400'}`}>
              <div className={`w-6 h-6 rounded-full ${step >= 2 ? 'bg-purple-400' : 'bg-purple-700'} flex items-center justify-center text-white text-sm`}>
                {step > 2 ? '✓' : '2'}
              </div>
              <span className="font-medium">Analyzing sentiment...</span>
            </div>
            <div className={`flex items-center gap-3 ${step >= 3 ? 'text-purple-200' : 'text-purple-400'}`}>
              <div className={`w-6 h-6 rounded-full ${step >= 3 ? 'bg-purple-400' : 'bg-purple-700'} flex items-center justify-center text-white text-sm`}>
                3
              </div>
              <span className="font-medium">Generating visualizations...</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};

const ReportPage = ({ data, onBack }) => {
  const [expandedCategory, setExpandedCategory] = useState(null);

  const categoryPieData = data.categories.map((cat) => ({
    name: cat.name,
    value: cat.percentage,
    count: cat.commentCount
  }));

  return (
    <div className="min-h-screen bg-gradient-to-br from-purple-50 to-purple-100" style={fontStyle}>
      <header className="bg-purple-900 shadow-lg sticky top-0 z-50">
        <div className="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center">
          <button onClick={onBack} className="flex items-center gap-2 text-purple-200 hover:text-purple-100">
            <ArrowLeft className="w-5 h-5" />
            <span className="font-medium">Back</span>
          </button>
          <div className="flex items-center gap-2">
            <Play className="w-6 h-6 text-purple-300" />
            <span className="text-lg font-bold text-white">Analysis Report</span>
          </div>
          <button className="flex items-center gap-2 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700">
            <Download className="w-4 h-4" />
            Export PDF
          </button>
        </div>
      </header>

      <main className="max-w-7xl mx-auto px-4 py-8">
        <div className="bg-yellow-50 border-2 border-yellow-300 rounded-xl shadow-lg p-6 mb-8">
          <div className="flex gap-6">
            <img src={data.basicInfo.thumbnail} alt="Video thumbnail" className="w-64 h-36 object-cover rounded-lg border-2 border-purple-300" />
            <div className="flex-1">
              <h1 className="text-2xl font-bold mb-2 text-purple-900">{data.basicInfo.title}</h1>
              <p className="text-purple-700 mb-4">{data.basicInfo.channelName}</p>
              <div className="grid grid-cols-4 gap-4">
                <div className="bg-yellow-100 border-2 border-yellow-400 p-3 rounded-lg">
                  <div className="text-3xl font-bold text-purple-800">{data.basicInfo.totalComments.toLocaleString()}</div>
                  <div className="text-sm text-purple-600">Total Comments</div>
                </div>
                <div className="bg-yellow-100 border-2 border-yellow-400 p-3 rounded-lg">
                  <div className="text-3xl font-bold text-purple-800">{data.basicInfo.videoDuration}</div>
                  <div className="text-sm text-purple-600">Duration</div>
                </div>
                <div className="bg-yellow-100 border-2 border-yellow-400 p-3 rounded-lg">
                  <div className="text-xl font-bold text-purple-800">{data.basicInfo.publishedAgo}</div>
                  <div className="text-sm text-purple-600">Published</div>
                </div>
                <div className="bg-yellow-100 border-2 border-yellow-400 p-3 rounded-lg">
                  <div className="text-sm font-semibold text-purple-800 mt-2">AI & Technology</div>
                  <div className="text-xs text-purple-600">Main Topic</div>
                </div>
              </div>
              <p className="text-purple-900 mt-4 text-sm leading-relaxed">{data.basicInfo.mainTopic}</p>
            </div>
          </div>
        </div>

        <div className="grid md:grid-cols-2 gap-6 mb-8">
          <div className="bg-yellow-50 border-2 border-yellow-300 rounded-xl shadow-lg p-6">
            <h2 className="text-xl font-bold mb-4 text-purple-900">Total Comments Growth</h2>
            <ResponsiveContainer width="100%" height={250}>
              <LineChart data={data.temporalData}>
                <CartesianGrid strokeDasharray="3 3" />
                <XAxis dataKey="period" />
                <YAxis />
                <Tooltip />
                <Line type="monotone" dataKey="cumulative" stroke="#7c3aed" strokeWidth={3} />
              </LineChart>
            </ResponsiveContainer>
          </div>
          <div className="bg-yellow-50 border-2 border-yellow-300 rounded-xl shadow-lg p-6">
            <h2 className="text-xl font-bold mb-4 text-purple-900">Comments Added Per Period</h2>
            <ResponsiveContainer width="100%" height={250}>
              <BarChart data={data.temporalData}>
                <CartesianGrid strokeDasharray="3 3" />
                <XAxis dataKey="period" />
                <YAxis />
                <Tooltip />
                <Bar dataKey="new" fill="#9f7aea" />
              </BarChart>
            </ResponsiveContainer>
          </div>
        </div>

        <div className="grid md:grid-cols-2 gap-6 mb-8">
          <div className="bg-white border-2 border-purple-300 rounded-xl shadow-lg p-6">
            <h2 className="text-xl font-bold mb-4 text-purple-900">What People Are Talking About</h2>
            <ResponsiveContainer width="100%" height={300}>
              <PieChart>
                <Pie data={categoryPieData} cx="50%" cy="50%" labelLine={false} label={entry => `${entry.name} (${entry.value}%)`} outerRadius={100} dataKey="value">
                  {categoryPieData.map((entry, index) => (
                    <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />
                  ))}
                </Pie>
                <Tooltip />
              </PieChart>
            </ResponsiveContainer>
          </div>
          <div className="bg-white border-2 border-purple-300 rounded-xl shadow-lg p-6">
            <h2 className="text-xl font-bold mb-4 text-purple-900">Comment Volume by Topic</h2>
            <ResponsiveContainer width="100%" height={300}>
              <BarChart data={data.categories} layout="vertical">
                <CartesianGrid strokeDasharray="3 3" />
                <XAxis type="number" />
                <YAxis dataKey="name" type="category" width={100} />
                <Tooltip />
                <Bar dataKey="commentCount" fill="#7c3aed" />
              </BarChart>
            </ResponsiveContainer>
          </div>
        </div>

        <div className="bg-white border-2 border-purple-300 rounded-xl shadow-lg p-6 mb-8">
          <h2 className="text-2xl font-bold mb-6 text-purple-900">Sentiment Analysis by Category</h2>
          <div className="space-y-4">
            {data.categories.map((category, idx) => (
              <div key={idx} className="border-2 border-purple-300 rounded-lg">
                <button
                  onClick={() => setExpandedCategory(expandedCategory === idx ? null : idx)}
                  className="w-full p-4 flex justify-between items-center hover:bg-purple-50"
                >
                  <div className="flex items-center gap-4">
                    <span className="font-bold text-lg text-purple-900">{category.name}</span>
                    <span className="bg-purple-200 text-purple-900 px-3 py-1 rounded-full text-sm font-semibold">
                      {category.commentCount.toLocaleString()} comments
                    </span>
                    <span className={`px-3 py-1 rounded-full text-sm font-semibold ${
                      category.controversyRate > 30 ? 'bg-red-200 text-red-900' : 
                      category.controversyRate > 10 ? 'bg-yellow-200 text-yellow-900' : 
                      'bg-green-200 text-green-900'
                    }`}>
                      {category.controversyRate}% Controversy
                    </span>
                  </div>
                  {expandedCategory === idx ? <ChevronUp className="text-purple-700" /> : <ChevronDown className="text-purple-700" />}
                </button>
                {expandedCategory === idx && (
                  <div className="p-6 border-t-2 border-purple-300 bg-purple-50">
                    <div className="grid md:grid-cols-2 gap-6 mb-6">
                      <div>
                        <h3 className="font-semibold mb-3 text-purple-900">Sentiment Distribution</h3>
                        <ResponsiveContainer width="100%" height={200}>
                          <PieChart>
                            <Pie
                              data={[
                                { name: 'Positive', value: category.sentiment.positive.count, color: '#10b981' },
                                { name: 'Negative', value: category.sentiment.negative.count, color: '#ef4444' },
                                { name: 'Neutral', value: category.sentiment.neutral.count, color: '#6b7280' }
                              ].filter(d => d.value > 0)}
                              cx="50%"
                              cy="50%"
                              outerRadius={80}
                              dataKey="value"
                              label
                            >
                              {[
                                { color: '#10b981' },
                                { color: '#ef4444' },
                                { color: '#6b7280' }
                              ].map((entry, index) => (
                                <Cell key={`cell-${index}`} fill={entry.color} />
                              ))}
                            </Pie>
                            <Tooltip />
                          </PieChart>
                        </ResponsiveContainer>
                      </div>
                      <div>
                        <h3 className="font-semibold mb-3 text-purple-900">Breakdown</h3>
                        <div className="space-y-2">
                          <div className="flex justify-between items-center p-3 bg-green-100 border border-green-300 rounded">
                            <span className="font-medium text-green-800">Positive</span>
                            <span className="text-green-900 font-bold">
                              {category.sentiment.positive.count.toLocaleString()} ({category.sentiment.positive.percentage}%)
                            </span>
                          </div>
                          <div className="flex justify-between items-center p-3 bg-red-100 border border-red-300 rounded">
                            <span className="font-medium text-red-800">Negative</span>
                            <span className="text-red-900 font-bold">
                              {category.sentiment.negative.count.toLocaleString()} ({category.sentiment.negative.percentage}%)
                            </span>
                          </div>
                          {category.sentiment.neutral.count > 0 && (
                            <div className="flex justify-between items-center p-3 bg-gray-100 border border-gray-300 rounded">
                              <span className="font-medium text-gray-800">Neutral</span>
                              <span className="text-gray-900 font-bold">
                                {category.sentiment.neutral.count.toLocaleString()} ({category.sentiment.neutral.percentage}%)
                              </span>
                            </div>
                          )}
                        </div>
                      </div>
                    </div>
                    <div>
                      <h3 className="font-semibold mb-3 text-purple-900">Example Comments</h3>
                      <div className="space-y-3">
                        {category.exampleComments.map((comment, cIdx) => (
                          <div key={cIdx} className="bg-white p-4 rounded-lg border-2 border-purple-200">
                            <p className="text-purple-900 mb-2">{comment.text}</p>
                            <div className="flex gap-4 text-sm text-purple-700">
                              <span className={`px-2 py-1 rounded ${
                                comment.sentiment === 'positive' ? 'bg-green-100 text-green-800' :
                                comment.sentiment === 'negative' ? 'bg-red-100 text-red-800' :
                                'bg-gray-100 text-gray-800'
                              }`}>
                                {comment.sentiment}
                              </span>
                              <span>👍 {comment.likes}</span>
                              <span>💬 {comment.replies} replies</span>
                            </div>
                          </div>
                        ))}
                      </div>
                    </div>
                  </div>
                )}
              </div>
            ))}
          </div>
        </div>

        <div className="bg-gradient-to-r from-purple-200 to-purple-300 border-2 border-purple-400 rounded-xl shadow-lg p-8">
          <h2 className="text-2xl font-bold mb-4 text-purple-900">Key Insights</h2>
          <ul className="space-y-3">
            {data.keyInsights.map((insight, idx) => (
              <li key={idx} className="flex gap-3">
                <span className="text-purple-700 font-bold text-lg">•</span>
                <span className="text-purple-900">{insight}</span>
              </li>
            ))}
          </ul>
        </div>

        <div className="flex justify-center gap-4 mt-8">
          <button onClick={onBack} className="px-6 py-3 bg-white border-2 border-purple-600 text-purple-900 font-semibold rounded-lg hover:bg-purple-50">
            Analyze Another Video
          </button>
          <button className="px-6 py-3 bg-purple-600 text-white font-semibold rounded-lg hover:bg-purple-700">
            Save Report
          </button>
        </div>
      </main>
    </div>
  );
};

const App = () => {
  const [page, setPage] = useState('home');
  const [loading, setLoading] = useState(false);

  const handleAnalyze = (url) => {
    setLoading(true);
    setTimeout(() => {
      setLoading(false);
      setPage('report');
    }, 5000);
  };

  const handleBack = () => {
    setPage('home');
  };

  if (loading) {
    return <LoadingState />;
  }

  if (page === 'report') {
    return <ReportPage data={mockAnalysisData} onBack={handleBack} />;
  }

  return <HomePage onAnalyze={handleAnalyze} />;
};

export default App;